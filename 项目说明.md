# 微博舆情分析知识图谱系统 - 项目说明

## 🎯 项目目标

将微博帖子的格式化数据转换为知识图谱，通过大模型智能分析：
- 提取事件主题和关键信息
- 判断舆论发展周期
- 分析公众情感和诉求
- 提供解决方案建议

## 📁 项目结构

```
public_opinion_graph/
│
├── 📄 核心模块
│   ├── config.py              # 配置管理（API密钥、数据库连接）
│   ├── data_parser.py         # 微博数据解析器
│   ├── llm_analyzer.py        # 通义千问LLM分析器
│   ├── kg_builder.py          # Neo4j知识图谱构建器
│   └── main_pipeline.py       # 主流程Pipeline
│
├── 🛠️ 辅助工具
│   ├── visualizer.py          # 图谱可视化和报告生成
│   ├── test_connection.py     # 环境测试脚本
│   └── quick_start.bat        # Windows快速启动脚本
│
├── 📚 文档
│   ├── README.md              # 项目说明和快速开始
│   ├── install_guide.md       # 详细安装指南
│   ├── usage_examples.md      # 使用示例
│   ├── 项目说明.md            # 项目详细说明（本文件）
│   ├── 讲解.md                # 分析思路讲解
│   └── 知识.md                # 舆论周期定义
│
├── ⚙️ 配置文件
│   ├── requirements.txt       # Python依赖包列表
│   ├── .env_template          # 环境变量模板
│   └── .env                   # 环境变量配置（需创建）
│
└── 📊 数据文件
    ├── weibo_comments_full.json       # 微博评论原始数据
    ├── analysis_result_*.json         # 分析结果（运行后生成）
    └── graph_data.json                # 图谱导出数据（可选）
```

## 🔄 工作流程

### 整体流程

```
输入数据 → 步骤1 → 步骤2 → 步骤3 → 步骤4 → 输出结果
   ↓         ↓        ↓        ↓        ↓         ↓
JSON     数据解析   LLM分析   结果保存  图谱构建  JSON+图谱
```

### 详细步骤

**步骤1: 数据解析** (`data_parser.py`)
- 加载微博JSON数据
- 提取事件信息（作者、内容、URL）
- 解析评论和回复结构
- 统计数据（评论数、回复数、时间跨度）
- 识别官方回应

**步骤2: LLM智能分析** (`llm_analyzer.py`)
- 主题分析：提取事件类型、核心实体、关键词
- 情感分析：对每条评论进行情感分类（正面/负面/中性）
- 诉求提取：识别公众主要诉求
- 周期判断：判断舆论发展阶段（潜伏期/爆发期/发酵期/消退期/平息期）
- 方案建议：提取已采取措施和建议方案

**步骤3: 结果保存**
- 生成时间戳文件名
- 保存JSON格式分析结果
- 打印核心结果摘要

**步骤4: 知识图谱构建** (`kg_builder.py`)
- 创建各类节点（事件、用户、评论、诉求等）
- 建立节点间关系
- 存储到Neo4j数据库

## 🧠 知识图谱设计

### 节点类型（Node Types）

| 节点类型 | 说明 | 主要属性 |
|---------|------|---------|
| Event | 事件节点 | url, content, event_type, location, impact |
| Organization | 组织机构 | name, type, platform |
| User | 用户 | name, location, user_id |
| Comment | 主评论 | author, content, sentiment, emotion, intensity |
| Reply | 回复 | author, content, time |
| OpinionPhase | 舆论周期 | phase, confidence, reason, trend |
| Demand | 诉求 | content, status, frequency |
| Solution | 解决方案 | content, type |

### 关系类型（Relationships）

| 关系 | 起点 → 终点 | 说明 |
|-----|------------|------|
| 发布 | Organization → Event | 组织发布事件 |
| 处于 | Event → OpinionPhase | 事件处于某个舆论阶段 |
| 发表 | User → Comment/Reply | 用户发表评论或回复 |
| 评论 | Comment → Event | 评论针对事件 |
| 回复 | Reply → Comment | 回复某条评论 |
| 提出 | User → Demand | 用户提出诉求 |
| 包含 | Comment → Demand | 评论包含诉求 |
| 采取 | Organization → Solution | 组织采取措施 |
| 针对 | Solution → Event | 方案针对事件 |

### 图谱示例

```
[上海地铁shmetro]─发布→[5号线故障事件]─处于→[发酵期]
                           ↑
                          评论
                           │
[用户A]─发表→[评论1:负面]─包含→[诉求:致歉信]
                         ↑
                        回复
                         │
             [官方]─发表→[回复1]
```

## 🤖 LLM分析详解

### 提示词设计

所有LLM分析都遵循统一模式：
1. 明确任务和目标
2. 提供结构化输入数据
3. 要求JSON格式输出
4. 温度参数控制（0.3-0.7）

### 核心分析任务

**1. 主题提取**
```python
输入: 微博主题内容 + 作者
输出: {
  "event_type": "事件类型",
  "core_entity": "核心实体",
  "location": "地点",
  "issue": "主要问题",
  "keywords": ["关键词"]
}
```

**2. 情感分析**
```python
输入: 评论内容
输出: {
  "sentiment": "正面/负面/中性",
  "emotion": "具体情绪",
  "intensity": 1-10,
  "demands": ["诉求列表"]
}
```

**3. 舆论周期判断**
```python
输入: 事件信息 + 统计数据 + 时间跨度 + 官方回应 + 情感分布
输出: {
  "phase": "潜伏期/爆发期/发酵期/消退期/平息期",
  "confidence": 1-10,
  "reason": "判断理由",
  "trend": "发展趋势"
}
```

**4. 解决方案提取**
```python
输入: 事件内容 + 评论摘要 + 官方回应
输出: {
  "taken_actions": ["已采取措施"],
  "unmet_demands": ["未满足诉求"],
  "suggested_solutions": ["建议方案"]
}
```

## 📊 数据格式

### 输入数据格式（微博JSON）

```json
{
  "url": "微博链接",
  "topic_author": "发布者",
  "topic": "主题内容",
  "comment_groups_count": 160,
  "total_replies": 73,
  "comment_groups": [
    {
      "index": 1,
      "main_comment": {
        "author": "用户名",
        "content": "评论内容",
        "time": "25-11-13 07:52",
        "source": "上海",
        "user_id": "用户ID"
      },
      "replies": [
        {
          "author": "回复者",
          "content": "回复内容",
          "time": "时间"
        }
      ]
    }
  ]
}
```

### 输出数据格式（分析结果）

```json
{
  "event_info": {...},
  "topic_analysis": {
    "event_type": "公共交通故障",
    "core_entity": "地铁5号线",
    "keywords": ["故障", "延误", "致歉"]
  },
  "sentiment_distribution": {
    "正面": 20,
    "负面": 95,
    "中性": 45
  },
  "opinion_phase": {
    "phase": "发酵期",
    "confidence": 8,
    "reason": "持续讨论且有官方回应"
  },
  "demands": {...},
  "solutions": {...}
}
```

## 🔧 技术栈

| 类别 | 技术 | 用途 |
|-----|------|-----|
| 编程语言 | Python 3.8+ | 主要开发语言 |
| 大模型API | 通义千问 (OpenAI格式) | 智能分析 |
| 图数据库 | Neo4j 5.x | 知识图谱存储 |
| 数据处理 | pandas | 数据操作 |
| API客户端 | openai, neo4j | 服务调用 |
| 配置管理 | python-dotenv | 环境变量 |

## 📈 性能考虑

### API调用优化
- 批量处理：每次处理20条评论
- 结果缓存：避免重复调用
- 错误重试：网络异常自动重试

### Neo4j性能
- 使用MERGE避免重复节点
- 批量创建关系
- 建立必要索引

### 资源限制
- 评论数量限制：默认处理前20条主评论
- 回复数量限制：每条评论最多5条回复
- 内存管理：流式处理大文件

## 🎨 扩展建议

### 1. 增强分析维度
- 添加关键人物识别
- 时间序列分析
- 传播路径分析
- 舆论预警机制

### 2. 可视化增强
- Web界面展示
- 交互式图谱浏览
- 动态时间轴
- 统计图表

### 3. 功能扩展
- 多平台支持（微信、抖音等）
- 实时监控
- 自动报告生成
- 邮件预警

### 4. 模型优化
- 领域微调模型
- 集成多个LLM
- 本地部署选项
- 知识库增强

## 📝 使用场景

### 场景1：政府舆情监控
- 实时监控公共事件
- 及时发现风险
- 辅助决策制定

### 场景2：企业危机管理
- 监控品牌声誉
- 分析客户反馈
- 制定应对策略

### 场景3：学术研究
- 社交媒体研究
- 舆论传播分析
- 情感计算研究

### 场景4：新闻媒体
- 热点事件分析
- 民意调查
- 深度报道支持

## 🔐 安全与隐私

### 数据安全
- 本地处理数据
- 不上传敏感信息
- API密钥加密存储

### 隐私保护
- 用户ID脱敏
- 个人信息过滤
- 合规使用数据

## 📞 技术支持

### 常见问题
参考 `usage_examples.md` 中的故障排查章节

### 日志记录
系统运行时会在控制台输出详细日志

### 调试模式
在代码中设置 `debug=True` 可查看更多信息

## 📅 更新日志

### v1.0.0 (2024-12-24)
- ✅ 基础数据解析功能
- ✅ 通义千问API集成
- ✅ Neo4j知识图谱构建
- ✅ 完整Pipeline实现
- ✅ 可视化和报告生成
- ✅ 测试和文档完善

### 后续计划
- [ ] Web可视化界面
- [ ] 批量处理优化
- [ ] 更多数据源支持
- [ ] 实时监控功能

## 📄 许可证

MIT License - 可自由使用和修改

## 🙏 致谢

感谢以下开源项目和服务：
- Neo4j图数据库
- 阿里云通义千问
- Python开源社区

---

**项目维护**: 本项目为Demo系统，仅供学习和参考使用。

